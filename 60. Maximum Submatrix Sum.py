def solve(A):
    prefix_sum= [[0 for j in range(len(A[0]))] for i in range(len(A))] 
    for i in range(0,len(A)):
        prefix_sum[i][0]=A[i][0]
        for j in range(1,len(A[0])):
            prefix_sum[i][j]=prefix_sum[i][j-1]+A[i][j]
    
    for j in range(0,len(A[0])):
        for i in range(1,len(A)):
            prefix_sum[i][j]=prefix_sum[i-1][j]+prefix_sum[i][j]
    print(prefix_sum)
    #Brute
    max_sum=A[0][0]
    for i in range(len(A)):
        for j in range(len(A[0])):
            for k in range(i,len(A)):
                for l in range(j,len(A[0])):
                    if i==k and l==j:
                        pass
                    res=prefix_sum[k][l]
                    if i>0:
                        res-=prefix_sum[i-1][l]
                    if j>0:
                        res-=prefix_sum[k][j-1]
                    if j>0 and i>0:
                        res+=prefix_sum[i-1][j-1]
                    print(res)
                    if res>max_sum:
                        max_sum=res
    return max_sum

def Kadane(B):
    max_sum=B[0]
    total_sum=B[0]
    for i in range(1,len(B)):
        total_sum=max(total_sum+B[i],B[i])
        if total_sum>max_sum:
            max_sum=total_sum
    return max_sum

def solve1( A):
    max_sum=A[0][0]
    for i in range(len(A[0])):
        temp_array=[0]*len(A)
        for j in range(i,len(A[0])):
            for k in range(len(A)):
                temp_array[k]+=A[k][j]        
            max_sum=max(max_sum,Kadane(temp_array))
            print(temp_array)
    
    return max_sum

#Max Sum Submatrix of size BXB
def solve2(A, B):
    
    #Prefix Sum
    prefix_sum= [[0 for j in range(len(A[0]))] for i in range(len(A))] 
    for i in range(0,len(A)):
        prefix_sum[i][0]=A[i][0]
        for j in range(1,len(A[0])):
            prefix_sum[i][j]=prefix_sum[i][j-1]+A[i][j]
    
    for j in range(0,len(A[0])):
        for i in range(1,len(A)):
            prefix_sum[i][j]=prefix_sum[i-1][j]+prefix_sum[i][j]
    #print(prefix_sum)
    #print(len(A))
    
    #Iterations
    max_sum=prefix_sum[B-1][B-1]
    for i in range(B-1,len(A)):
        for j in range(B-1,len(A)):
            #print(A[i][j])
            res=prefix_sum[i][j]
            if i-B+1>0:
                res-=prefix_sum[i-B][j]
            if j-B+1>0:
                res-=prefix_sum[i][j-B]
            if j-B+1>0 and i-B+1>0:
                res+=prefix_sum[i-B][j-B]
            #print(res)
            if res>max_sum:
                max_sum=res
    return max_sum

A1=[
  [-33, 34, 0, 69, 24, -22, 58, 62, -36, 5, 45, -19, -73, 61, -9, 95],
  [42, -73, -64, 91, -96, 2, 53, -8, 82, -79, 16, 18, -5, -53, 26, 71],
  [38, -31, 12, -33, -1, -65, -6, 3, -89, 22, 33, -27, -36, 41, 11, -47],
  [-32, 47, -56, -38, 57, -63, -41, 23, 41, 29, 78, 16, -65, 90, -58, -12],
  [6, -60, 42, -36, -52, -54, -95, -10, 29, 70, 50, -94, 1, 93, 48, -71],
  [-77, -16, 54, 56, -60, 66, 76, 31, 8, 44, -61, -74, 23, 37, 38, 18],
  [-18, 29, 41, -67, 15, -61, -42, 4, 30, 77, 6, -27, 86, -79, 45, 24],
  [-28, -30, -71, 77, 73, -3, 12, 86, -10, 61, -64, 55, 67, -45, 74, -69],
  [-48, 50, 50, 41, 24, 66, -70, 7, 91, -93, 37, -43, -13, 53, 83, 45],
  [9, -91, 58, -79, 88, -78, 46, 6, -70, -87, 68, 0, 91, 62, -45, -90],
  [59, -76, 37, 48, -17, 95, -59, -98, 50, -9, -64, 74, -80, 96, -79, 48],
  [99, -32, -16, -19, 34, -47, 99, -82, 38, 0, 88, 27, -33, 28, -7, -52],
  [-17, -93, -79, 10, -83, -87, 14, 9, -84, 35, -49, -100, -51, 19, 56, 98],
  [3, -76, -92, -56, -91, 89, 2, 95, -15, -7, 43, 23, 87, 14, 3, -52],
  [-100, -42, -82, 80, 96, 98, -19, 89, 98, -91, 57, -28, -78, 38, -8, -62],
  [79, 90, -43, 58, 91, -85, -12, 56, 11, -98, -66, -28, -45, 28, -54, 62]
]
A2=[
  [11, -86, 47, -7, 29, 87, -20, -15, 64, -66, -24, -85, 18, 84, -53, -52, 47, 55, -68, 81, -63],
  [-73, -4, -41, 24, 99, -47, 1, -59, -96, 29, -85, 65, -50, 32, -17, 19, -4, -61, 78, -62, -59],
  [-97, -94, -80, -30, -51, -95, 24, -22, 87, 84, -71, 39, -2, 73, -62, -85, -98, -59, -15, -37, -89],
  [-34, -73, 83, 30, 65, -18, 82, -69, -65, -10, -88, -44, -98, -52, 13, 26, -3, -36, -85, -7, 7],
  [-63, -82, 38, -76, -30, 83, 45, 28, -41, -17, -79, 37, 60, 49, 23, -17, 5, -53, 13, 86, 84],
  [-91, -66, 0, 70, -61, 57, -32, -44, -15, 92, -78, 33, 35, 83, -73, -1, -39, -10, 35, 0, -21],
  [73, 6, -15, -55, -91, -64, 81, 39, -1, 1, -93, 95, -81, -16, -73, 55, 60, 33, -48, -100, -97],
  [-12, 98, -25, 69, 4, 90, -57, 57, -43, 19, -25, 49, 90, 46, 98, -33, 46, 9, -20, -21, 81],
  [-93, 19, 38, -75, -1, 70, -86, 10, 55, -68, 65, -82, 20, -63, -36, 9, 3, 44, -50, 41, 1],
  [44, -73, 41, 10, -4, -76, -17, -2, -60, 31, 70, 54, 35, 3, -55, -91, -86, -68, 17, -70, 18],
  [-68, -87, -10, -39, 32, -65, 17, -55, 21, -82, -95, 33, 21, -54, 70, 88, 94, -92, -73, -65, 77],
  [-25, -95, -50, -58, -46, 18, 90, 24, 79, 65, 54, 71, -78, -56, -33, 9, -90, -28, 52, -26, 77],
  [-3, 70, 41, -33, 41, -83, 68, -35, 21, -45, 27, 14, -17, 37, 32, 49, 62, -18, -65, 92, 35],
  [30, 34, 20, 28, -12, 24, -66, -67, -97, 25, 22, 82, 60, -35, 30, -36, -77, 22, -14, 8, -62],
  [-69, 65, -74, 62, 63, 78, -81, -49, 41, 15, -24, 68, 21, -2, 87, 31, -61, 39, 52, -70, -26],
  [81, 42, 18, 0, 0, -66, -94, -20, 90, 23, 99, 68, -15, -66, -45, 44, -56, 8, -100, -81, 18],
  [49, 47, 80, -1, -52, -16, 19, 32, 40, -12, 70, -3, -67, 40, -78, 45, 40, 27, -50, -18, -53],
  [-1, -50, 30, 96, 4, 31, -95, -49, -18, 39, 67, 70, -24, 43, 56, 73, 16, 57, -14, 66, -67],
  [-57, -28, -86, -2, -29, 37, -39, -91, 20, 86, 27, -59, -47, 23, 28, -9, 97, -1, -19, -77, 10],
  [-29, 78, 93, -10, -47, -66, -34, -53, 13, -78, 45, 74, -12, -78, 77, 19, -17, 66, -95, 94, -54],
  [24, -59, -11, -2, 97, -34, -40, 91, 73, -35, -95, -94, -62, 96, 18, -38, 44, 26, -85, -7, 23]
]
A=[
  [90, 91, 68, 45, 17, 45, 67, -30, 38, 86, 25, -98, 82, -5, -72, -45, 96, 20, 41, -87, 46, -22, -73, 3, 24, -14, 86, 65, 97, -32, -84, -82, 44, -96],
  [63, -21, -85, 72, -57, -93, -83, 26, -83, 80, -43, -31, 36, -42, 0, -78, -26, -65, -72, 14, 58, -1, -73, 92, 21, 40, -11, 36, -57, -7, 46, -79, -72, -6],
  [-82, -98, 43, -4, -73, -83, -15, -97, -28, 76, -15, 11, -34, -46, 54, 42, -57, 0, 50, -34, -91, 34, 98, 0, 82, 16, -15, -7, -47, 24, -79, -52, 11, -25],
  [-57, 3, -77, 16, 23, -15, -97, 12, 17, -16, -31, -93, 66, 4, 84, 81, -35, 72, -70, 60, -13, 15, 45, 93, -79, -58, -35, -51, 58, 48, 66, -30, -4, -7],
  [3, 67, -17, -40, 14, -56, -85, 14, 24, 61, 25, -100, -33, 72, -51, -83, -82, -87, 58, 79, -31, -14, -25, 24, -54, 87, 17, -18, -29, 40, 1, -65, -75, -27],
  [47, -94, 88, 17, -57, 38, 84, 57, -61, -6, -40, 31, -47, -35, -63, 90, 71, -73, -3, -40, 84, -9, -1, -9, 40, -10, 6, -87, -2, -77, 90, 62, 25, -79],
  [95, 46, 78, 54, -99, 23, -87, -2, 46, -13, -22, -88, 18, -18, -16, 14, 56, -81, -42, 27, 30, -99, -74, -8, 66, -76, 44, 55, 2, -81, -12, 84, -79, 56],
  [-65, -32, 99, -90, -87, 8, 35, 15, 62, 54, 2, -66, 15, -90, -37, -26, -8, 84, -19, 48, -60, -76, 1, 81, 2, -7, -4, -80, 1, -45, 79, 78, -86, -93],
  [-27, -1, -34, -32, 85, 24, 64, 87, -71, 18, 11, -98, 22, -58, 87, 42, -3, 88, 72, -62, -87, 33, 48, -69, 50, 96, -41, -91, -71, 17, 24, 6, 21, 89],
  [-75, 38, -91, -31, -19, -61, 7, -71, 13, 54, -15, -50, 93, -51, 94, -98, -92, 34, 27, -28, 7, -4, 42, 72, -50, -92, -81, -79, -17, 27, 73, 5, -56, 58],
  [75, -56, -9, 34, 52, 83, -76, 86, -37, 31, 1, 53, 55, 26, 96, 28, -49, -39, -90, -20, 53, -73, -9, -9, -48, -91, 26, -31, 34, -37, 30, 21, -33, -51],
  [-83, -35, -89, 25, 8, 62, -50, 24, -85, 99, -30, -45, 11, -79, -20, -63, 69, -93, 35, -34, -8, -18, -51, 6, 94, 24, -56, -30, -41, -67, 56, -7, -9, -78],
  [-95, -13, 57, -2, -72, -54, 20, -3, 29, 74, -11, -41, -36, -21, -28, -31, -92, -83, -37, -78, -82, 83, 77, -80, -22, -46, -36, -53, -97, -76, -74, -37, 91, -8],
  [-8, 54, -70, -51, 75, -75, -7, -9, 62, 71, 37, 40, -12, 54, 63, 67, -64, -39, 19, 13, 6, -15, 50, 4, -60, 72, 53, -35, -55, 6, 26, 57, -4, 46],
  [-20, 96, -16, -7, 94, -95, -41, -62, 56, 79, -4, 82, 29, 56, -58, -60, 36, -21, -6, 43, 6, 32, 79, 90, -65, -19, 16, 77, 73, -83, 78, -97, -19, -77],
  [-68, 75, -68, 40, 31, 86, 61, 97, 53, -91, -65, 21, 37, 43, 33, 6, 96, 86, -65, -27, -66, -93, -96, -93, 52, -74, 31, 69, -92, 31, 31, 7, 46, -22],
  [42, 45, 30, 61, -53, 70, -74, 87, -86, -14, 5, 39, 65, 21, -56, 2, -43, 20, 16, -62, 31, 88, 44, -61, 35, 1, 88, -9, 40, -68, -66, -59, 65, 56],
  [-67, 86, 28, -91, 63, 0, -95, 30, 31, -90, 5, 97, 18, 16, 96, -11, -67, -82, 3, 11, -40, 35, -10, -80, -54, -40, -55, 90, 45, 70, -87, -64, 10, -32],
  [6, 7, 56, 1, -21, -6, -46, 26, 13, -54, -57, 14, 15, 87, -10, 97, 69, -67, 48, 30, -96, -38, -64, -40, -70, -89, 9, 68, -70, 38, 32, -99, 2, 91],
  [-94, -96, 79, -27, -90, 65, -63, -81, -82, -51, 12, -54, 18, -62, -11, -10, -67, -28, 89, -47, 44, 65, 3, 70, 69, 39, 68, -63, -76, -44, 88, 66, -4, -42],
  [86, -80, -68, -75, -24, 9, -9, -58, 21, 87, 9, 89, 83, 21, 87, 77, 24, -62, 14, -38, -45, 77, 6, -81, -57, 2, -88, 21, -8, -93, -82, 44, 48, -85],
  [-21, 21, -52, -49, -13, -25, -21, -42, 83, 46, 87, -93, -12, 25, 95, -40, 20, 90, 67, -44, 54, -28, -54, 56, -21, 0, -7, -97, 9, 8, 85, -11, -29, 80],
  [27, 50, 41, 2, 93, 94, 57, -79, 56, -97, -34, -72, -12, -88, 64, 35, -28, -67, 20, -98, -98, -52, 6, 13, 61, -90, 84, -36, 85, 71, 92, -88, 38, 89],
  [1, 69, -91, 88, 74, 74, -33, -62, -44, 98, -72, 53, 9, -36, 20, -91, 25, 5, -93, -82, 0, 28, -22, -73, -97, 55, 39, 40, -81, -20, 93, -43, 92, 26],
  [-63, 59, 39, 81, 52, 83, -58, 79, -93, -11, 80, -35, 83, 94, -37, -87, 25, 61, 97, 61, -15, -5, -93, 56, 44, -95, -76, -44, -8, -50, -15, -80, -69, 16],
  [86, -66, -9, -53, -83, 47, -11, -8, -4, -66, -77, 72, -52, -77, -9, 66, -39, 81, 41, -39, -57, -55, -4, -71, 73, 0, -50, 3, -72, 31, 41, 23, 42, 10],
  [88, -87, 88, -21, -27, -80, 37, 55, -86, -69, -100, 97, -89, -92, 17, -98, 28, -55, -61, -71, -1, 33, 96, -16, -24, 29, -87, -97, 91, -97, 64, -5, -2, -58],
  [40, -55, -36, -78, -85, -40, 89, 70, 49, -3, -9, -76, -48, 21, 40, 13, -65, 16, -11, 96, 48, -36, -42, 43, -19, 80, -93, -64, -30, -38, -37, 66, -37, -45],
  [98, 72, 31, -39, 0, -7, -59, -51, -56, -63, -18, -81, -33, -37, -84, -90, -58, -81, -87, -20, 8, 6, -53, -94, -48, -4, 71, 0, 77, -44, 35, -89, 87, 2],
  [-16, -77, -17, 13, 32, -21, 82, -100, -84, 58, -57, -93, 9, -85, 65, 30, -28, 17, -42, -19, -28, -43, 57, 40, 7, 11, -43, 93, 71, 87, 43, -32, -98, -12],
  [-2, 82, -48, 77, -43, 85, -7, 16, -72, 94, -9, 71, 7, 12, 32, 9, -8, -23, -73, -95, -9, -9, 83, -19, -30, -68, -96, 18, 14, -87, 74, -51, 52, -73],
  [15, 37, 88, -45, 77, -49, 68, 84, 77, -54, -80, -94, 62, 45, 45, 41, -68, -42, -6, 54, -6, 13, 38, 98, 5, 39, -49, -27, -53, -81, -21, -83, 45, -54],
  [-100, -2, 97, 41, 25, -60, 99, -91, -44, -57, 92, -10, -26, -42, -21, -12, 73, 0, -36, -46, -33, 30, -74, -48, -25, 77, 34, -80, -7, -77, 40, 59, 18, -72],
  [76, 45, -47, -65, 65, -74, -30, 12, -20, 26, 59, -40, 77, -100, -26, 83, 81, 6, 87, 1, 68, 92, 14, 41, 5, -6, 30, -70, -86, 98, 39, 46, 62, 67]
]
B=29
print(solve2(A,B))



